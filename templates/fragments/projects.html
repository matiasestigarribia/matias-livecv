<section class="py-24 px-6">
    <div class="max-w-7xl mx-auto">

        <h2 class="text-5xl md:text-6xl font-bold mb-8 tracking-tight text-gradient">
            {% if lang == 'pt' %}TRABALHOS EM DESTAQUE.{% elif lang == 'es' %}TRABAJOS DESTACADOS.{% else %}FEATURED WORK.{% endif %}
        </h2>
        <div class="w-32 h-1 bg-gradient-to-r from-accent-cyan to-transparent mb-12"></div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">

            {% for project in projects %}
            <div class="group relative h-full">
                <div class="overflow-hidden cursor-pointer bg-dark-elevated border border-accent-cyan/10 rounded-xl transition-all duration-500 hover:border-accent-cyan/50 hover:shadow-[0_0_30px_rgba(0,212,255,0.1)] hover:-translate-y-1 h-full flex flex-col"
                    hx-get="/projects/{{ project.slug }}?lang={{ lang }}" hx-target="#project-detail-modal" hx-swap="innerHTML"
                    onclick="openProjectModal()">

                    <div class="aspect-video overflow-hidden bg-dark-deep border-b border-accent-cyan/10">
                        {% set cover_url = None %}
                        {% for img in project.images %}
                        {% if img.is_cover %}
                        {% if img.image_url.startswith('http') %}
                        {% set cover_url = img.image_url %}
                        {% else %}
                        {% set cover_url = url_for('static', path='images/projects/' + img.image_url) %}
                        {% endif %}
                        {% endif %}
                        {% endfor %}

                        {# Fallback to the first image if no cover is set #}
                        {% if not cover_url and project.images|length > 0 %}
                        {% set first_img = project.images[0] %}
                        {% if first_img.image_url.startswith('http') %}
                        {% set cover_url = first_img.image_url %}
                        {% else %}
                        {% set cover_url = url_for('static', path='images/projects/' + first_img.image_url) %}
                        {% endif %}
                        {% endif %}

                        {% if cover_url %}
                        <img src="{{ cover_url }}" alt="{{ project.title.get(lang, project.title.get('en', 'Project')) }}"
                            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 opacity-90 group-hover:opacity-100">
                        {% else %}
                        <div class="w-full h-full flex items-center justify-center text-4xl text-gray-700">
                            ⌘
                        </div>
                        {% endif %}
                    </div>

                    <div class="p-8 flex flex-col flex-1">
                        <h3
                            class="text-xl font-bold mb-3 text-text-primary tracking-wide transition-colors group-hover:text-accent-cyan">
                            {{ project.title.get(lang, project.title.get('en', '')) or ('Projeto Sem Título' if lang == 'pt' else ('Proyecto Sin Título' if lang == 'es' else 'Untitled Project')) }}
                        </h3>

                        <p class="text-text-secondary text-sm leading-relaxed mb-8 line-clamp-3">
                            {{ project.short_description.get(lang, project.short_description.get('en', '')) or ('Sem descrição disponível.' if lang == 'pt' else ('Sin descripción disponible.' if lang == 'es' else 'No description available.')) }}
                        </p>

                        <div class="flex items-center justify-between mt-auto">
                            <span
                                class="text-accent-cyan text-sm font-semibold tracking-widest uppercase flex items-center gap-2 transition-transform group-hover:translate-x-1">
                                {% if lang == 'pt' %}Ver Detalhes{% elif lang == 'es' %}Ver Detalles{% else %}View Details{% endif %} <span class="text-lg">→</span>
                            </span>

                            {% if project.featured %}
                            <span
                                class="px-3 py-1 bg-accent-cyan/10 text-accent-cyan border border-accent-cyan/20 rounded text-[10px] uppercase tracking-widest font-semibold">
                                {% if lang == 'pt' %}Destaque{% elif lang == 'es' %}Destacado{% else %}Featured{% endif %}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}

        </div>

        {% if not projects %}
        <div class="text-center py-24 border border-accent-cyan/10 rounded-xl bg-dark-elevated/30">
            <p class="text-text-tertiary text-lg tracking-widest uppercase">{% if lang == 'pt' %}Sistema vazio. Aguardando implantação.{% elif lang == 'es' %}Sistema vacío. Esperando despliegue.{% else %}System empty. Awaiting deployment.{% endif %}</p>
        </div>
        {% endif %}

    </div>
</section>

<div id="project-detail-modal-wrapper"
    class="fixed inset-0 z-50 hidden bg-[#05080f]/90 backdrop-blur-md overflow-y-auto transition-opacity"
    onclick="closeProjectModal(event)">
    <div id="project-detail-modal" class="min-h-screen py-12 px-4 flex items-center justify-center">
    </div>
</div>

<script>
    function openProjectModal() {
        const modal = document.getElementById('project-detail-modal-wrapper');
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeProjectModal(event) {
        if (event.target.id === 'project-detail-modal-wrapper' || event.target.closest('.close-modal')) {
            document.getElementById('project-detail-modal-wrapper').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    }

    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            const modal = document.getElementById('project-detail-modal-wrapper');
            if (!modal.classList.contains('hidden')) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }
    });
</script>

<style>
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
