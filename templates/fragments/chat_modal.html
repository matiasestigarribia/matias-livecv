<!-- Chat Modal - Full Screen AI Interface -->
<div id="chat-modal-inner"
    class="fixed inset-0 z-50 bg-dark-deep/95 backdrop-blur-lg flex items-center justify-center p-4 animate-fade-in"
    data-i18n-just-now="{% if lang == 'pt' %}Agora mesmo{% elif lang == 'es' %}Ahora mismo{% else %}Just now{% endif %}"
    data-i18n-error="{% if lang == 'pt' %}âš ï¸ Estou tendo problemas para conectar agora. Por favor, tente novamente em um momento.{% elif lang == 'es' %}âš ï¸ Estoy teniendo problemas para conectarme ahora. Por favor, intenta de nuevo en un momento.{% else %}âš ï¸ I'm having trouble connecting right now. Please try again in a moment.{% endif %}">

    <!-- Chat Container -->
    <div
        class="w-full max-w-4xl h-[80vh] bg-dark-elevated rounded-2xl border border-accent-cyan/20 shadow-2xl flex flex-col overflow-hidden">

        <!-- Chat Header -->
        <div class="p-6 bg-dark-mid border-b border-accent-cyan/10 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <!-- AI Avatar -->
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-br from-accent-cyan to-accent-purple flex items-center justify-center text-2xl animate-pulse-slow">
                    ðŸ¤–
                </div>

                <!-- AI Info -->
                <div>
                    <h3 class="text-xl font-bold">MatIAs AI</h3>
                    <p class="text-sm text-text-tertiary flex items-center gap-2">
                        <span class="w-2 h-2 bg-accent-green rounded-full animate-pulse"></span>
                        {% if lang == 'pt' %}GÃªmeo Digital do MatÃ­as â€¢ Sempre Online{% elif lang == 'es' %}Gemelo Digital de MatÃ­as â€¢ Siempre En LÃ­nea{% else %}MatÃ­as's Digital Twin â€¢ Always Online{% endif %}
                    </p>
                </div>
            </div>

            <!-- Close Button -->
            <button onclick="closeChat()" aria-label="Close chat"
                class="w-10 h-10 rounded-full bg-dark-deep border border-accent-cyan/20 flex items-center justify-center hover:bg-accent-cyan hover:text-dark-deep hover:scale-110 transition-all duration-300">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- Messages Container -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4 scroll-smooth"
            style="scrollbar-width: thin;">

            <!-- Welcome Message -->
            <div class="flex justify-start animate-slide-in">
                <div class="max-w-[80%]">
                    <div class="bg-dark-mid border border-accent-cyan/10 rounded-2xl rounded-tl-sm p-4">
                        <p class="text-text-primary">
                            {% if lang == 'pt' %}
                            ðŸ‘‹ OlÃ¡! Sou <span class="font-bold text-accent-cyan">MatIAs</span>, o gÃªmeo digital do MatÃ­as, movido por IA.
                            {% elif lang == 'es' %}
                            ðŸ‘‹ Â¡Hola! Soy <span class="font-bold text-accent-cyan">MatIAs</span>, el gemelo digital de MatÃ­as, impulsado por IA.
                            {% else %}
                            ðŸ‘‹ Hi! I'm <span class="font-bold text-accent-cyan">MatIAs</span>, MatÃ­as's digital twin
                            powered by AI.
                            {% endif %}
                        </p>
                        <p class="text-text-secondary mt-2">
                            {% if lang == 'pt' %}
                            Posso responder perguntas sobre a experiÃªncia, habilidades, projetos e disponibilidade do MatÃ­as. O que vocÃª gostaria de saber?
                            {% elif lang == 'es' %}
                            Puedo responder preguntas sobre la experiencia, habilidades, proyectos y disponibilidad de MatÃ­as. Â¿QuÃ© te gustarÃ­a saber?
                            {% else %}
                            I can answer questions about MatÃ­as's experience, skills, projects, and availability.
                            What would you like to know?
                            {% endif %}
                        </p>
                    </div>
                    <p class="text-xs text-text-tertiary mt-2 ml-4">{% if lang == 'pt' %}Agora mesmo{% elif lang == 'es' %}Ahora mismo{% else %}Just now{% endif %}</p>
                </div>
            </div>

        </div>

        <!-- Quick Suggestions -->
        <div class="px-6 py-3 bg-dark-mid/50 border-t border-accent-cyan/5">
            <p class="text-xs text-text-tertiary mb-2">{% if lang == 'pt' %}Perguntas rÃ¡pidas:{% elif lang == 'es' %}Preguntas rÃ¡pidas:{% else %}Quick questions:{% endif %}</p>
            <div class="flex flex-wrap gap-2">
                <button onclick="sendQuickMessage('{% if lang == 'pt' %}Quais sÃ£o suas principais habilidades tÃ©cnicas?{% elif lang == 'es' %}Â¿CuÃ¡les son tus principales habilidades tÃ©cnicas?{% else %}What are your main technical skills?{% endif %}')"
                    class="px-3 py-1 text-sm bg-dark-elevated border border-accent-cyan/20 rounded-full hover:border-accent-cyan hover:bg-accent-cyan/10 transition-all">
                    {% if lang == 'pt' %}Habilidades tÃ©cnicas?{% elif lang == 'es' %}Â¿Habilidades tÃ©cnicas?{% else %}Technical skills?{% endif %}
                </button>
                <button onclick="sendQuickMessage('{% if lang == 'pt' %}Me fale sobre seu projeto mais recente{% elif lang == 'es' %}CuÃ©ntame sobre tu proyecto mÃ¡s reciente{% else %}Tell me about your most recent project{% endif %}')"
                    class="px-3 py-1 text-sm bg-dark-elevated border border-accent-cyan/20 rounded-full hover:border-accent-cyan hover:bg-accent-cyan/10 transition-all">
                    {% if lang == 'pt' %}Projetos recentes?{% elif lang == 'es' %}Â¿Proyectos recientes?{% else %}Recent projects?{% endif %}
                </button>
                <button onclick="sendQuickMessage('{% if lang == 'pt' %}VocÃª estÃ¡ disponÃ­vel para trabalho freelance?{% elif lang == 'es' %}Â¿EstÃ¡s disponible para trabajo freelance?{% else %}Are you available for freelance work?{% endif %}')"
                    class="px-3 py-1 text-sm bg-dark-elevated border border-accent-cyan/20 rounded-full hover:border-accent-cyan hover:bg-accent-cyan/10 transition-all">
                    {% if lang == 'pt' %}Disponibilidade?{% elif lang == 'es' %}Â¿Disponibilidad?{% else %}Availability?{% endif %}
                </button>
            </div>
        </div>

        <!-- Input Area -->
        <!-- NOTE: HTMX removed â€” streaming requires native fetch + ReadableStream -->
        <!-- onsubmit="return false" is a safety-net: prevents page navigation if the
             JS event listener is not yet attached (e.g. HTMX script execution timing). -->
        <form id="chat-form" action="javascript:void(0);" onsubmit="return false;" class="p-6 bg-dark-mid border-t border-accent-cyan/10">

            <!-- Hidden language input -->
            <input type="hidden" name="language" id="chat-language" value="{{ lang }}">

            <div class="flex gap-3">
                <!-- Text Input -->
                <input type="text" name="message" id="chat-input" placeholder="{% if lang == 'pt' %}Digite sua pergunta...{% elif lang == 'es' %}Escribe tu pregunta...{% else %}Type your question...{% endif %}" required
                    autocomplete="off"
                    class="flex-1 px-4 py-3 bg-dark-elevated border border-accent-cyan/20 rounded-xl text-text-primary placeholder-text-tertiary focus:outline-none focus:border-accent-cyan focus:ring-2 focus:ring-accent-cyan/20 transition-all">

                <!-- Send Button -->
                <button type="button" id="chat-send-btn" aria-label="Send message"
                    class="w-12 h-12 rounded-xl bg-gradient-to-r from-accent-cyan to-accent-purple hover:scale-105 hover:shadow-lg hover:shadow-accent-cyan/50 transition-all duration-300 flex items-center justify-center disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:scale-100">
                    <i data-lucide="send" class="w-5 h-5 text-dark-deep"></i>
                </button>
            </div>

            <!-- Powered by info -->
            <p class="text-xs text-text-tertiary mt-3 text-center">
                Powered by LangChain + Groq + RAG â€¢
                <a href="/about" hx-get="/about" hx-target="#content" hx-swap="innerHTML" hx-push-url="true"
                    onclick="closeChat()" class="text-accent-cyan hover:underline">
                    {% if lang == 'pt' %}Saiba mais sobre MatIAs{% elif lang == 'es' %}Conoce mÃ¡s sobre MatIAs{% else %}Learn more about MatIAs{% endif %}
                </a>
            </p>
        </form>

    </div>
</div>


<style>
    /* Custom scrollbar for chat messages */
    #chat-messages::-webkit-scrollbar {
        width: 6px;
    }

    #chat-messages::-webkit-scrollbar-track {
        background: var(--color-dark-deep);
        border-radius: 3px;
    }

    #chat-messages::-webkit-scrollbar-thumb {
        background: var(--color-accent-cyan);
        border-radius: 3px;
    }

    #chat-messages::-webkit-scrollbar-thumb:hover {
        background: var(--color-accent-purple);
    }

    /* Animations */
    @keyframes slide-in {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-slide-in {
        animation: slide-in 0.3s ease-out;
    }

    @keyframes fade-in {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .animate-fade-in {
        animation: fade-in 0.3s ease-out;
    }

    /* Message bubble entry */
    #chat-messages>div {
        animation: slide-in 0.3s ease-out;
    }
</style>
